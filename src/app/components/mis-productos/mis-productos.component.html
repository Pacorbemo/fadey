<form id="uploadForm" (submit)="subirProducto()">
  @for(campo of campos; track campo.field){
    <label for="{{campo.field}}">
      {{ campo.label }}
    </label>
    @if(campo.field !== 'descripcion'){
      <input 
        type="{{campo.type}}" 
        id="{{campo.field}}" 
        [(ngModel)]="producto[campo.field]" 
        name="{{campo.field}}" 
        required
      />
    } @else {
      <textarea 
        id="{{campo.field}}"
        [(ngModel)]="producto[campo.field]" 
        name="{{campo.field}}" 
        required
      ></textarea>
    }
  }
  <div class="upload-area" (drop)="handleDrop($event)" (dragover)="handleDragOver($event)">
    <label for="fileInput" class="custom-file-upload">
      Seleccionar Imagen o arrastra aqu√≠
    </label>
    <input 
      type="file" 
      id="fileInput" 
      class="file-input" 
      #fileInput
      (change)="seleccionarImagen($event)" 
      style="display: none;"
    />
  </div>
  @if(producto.foto){
    <div class="preview-container">
      <img [src]="urlImagen()" alt="Imagen del producto" class="preview-image" />
      <button class="remove-button" (click)="eliminarImagen($event)">Eliminar Imagen</button>
    </div>
  } @else {
    <div class="preview-container">
      <p>No hay imagen seleccionada</p>
    </div>
  }
  <button type="submit">Subir Producto</button>
</form>

<ul>
  <li class="header">
    @for(campo of campos; track campo.field){
      <div class="col {{campo.colClass}}">
        {{ campo.label }}
      </div>
    }
    <div class="col col-5">Imagen</div>
  </li>
  @for(producto of productos; track producto.id){
  <li class="row">
    @for(campo of campos; track campo.field){
      <div class="col {{campo.colClass}}" (dblclick)="editCell(producto, campo.field)">
        @if(editingCell?.id !== producto.id || editingCell?.field !== campo.field){
          {{ producto[campo.field] }}
        } @else {
          @if(campo.field === 'descripcion'){
            <textarea id="input-{{producto.id}}-{{campo.field}}" [(ngModel)]="producto[campo.field]" (blur)="finishEditCell()"></textarea>
          } @else {
            <input id="input-{{producto.id}}-{{campo.field}}" type="{{campo.type}}" [(ngModel)]="producto[campo.field]" (blur)="finishEditCell()" />
          }
        }
      </div>
    }
    <div class="col col-5" (dblclick)="editCell(producto, 'foto')">
      @if(editingCell?.id == producto.id && editingCell?.field == 'foto'){
        <input id="input-{{producto.id}}-foto" type="file" (change)="seleccionarCambioImagen($event)" />
      }
      @else if(producto.foto){
        <img [src]="producto.foto" alt="{{ producto.nombre }}" />
      }
      @else {
        <p>Sin imagen</p>
      }
    </div>
  </li>
}
</ul>