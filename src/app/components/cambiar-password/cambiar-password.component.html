<div class="cambiar-password-container">
  <button type="button" class="btn-generar btn-generar-absolute" (click)="generarPasswordSegura()" [disabled]="cambiandoPassword" aria-label="Generar contraseña segura">
    <img src="/svgs/icono-dado.svg" width="18" height="18" style="vertical-align:middle;margin-right:4px;" alt="Icono dado" />
    Generar contraseña segura
  </button>
  <h2>Cambiar contraseña</h2>
  <form (ngSubmit)="cambiarPassword()" #form="ngForm" autocomplete="off">
    <div class="form-group">
      <label for="passwordActual">Contraseña actual</label>
      <div class="input-con-visualizador">
        <input [type]="mostrarPasswordActual ? 'text' : 'password'" id="passwordActual" name="passwordActual" [(ngModel)]="passwordActual" required [disabled]="cambiandoPassword" />
        <span class="icono-visualizar" (click)="mostrarPasswordActual = !mostrarPasswordActual" [attr.aria-label]="mostrarPasswordActual ? 'Ocultar' : 'Mostrar'" tabindex="0">
          @if(!mostrarPasswordActual){
            <img src="/svgs/icono-ojo.svg" width="22" height="22" alt="Mostrar" />
          }
          @if(mostrarPasswordActual){
            <img src="/svgs/icono-ojo-off.svg" width="22" height="22" alt="Ocultar" />
          }
        </span>
      </div>
    </div>
    <div class="form-group">
      <label for="passwordNueva">Nueva contraseña</label>
      <div class="input-con-visualizador">
        <input [type]="mostrarPasswordNueva ? 'text' : 'password'" id="passwordNueva" name="passwordNueva" [(ngModel)]="passwordNueva" required minlength="6" [disabled]="cambiandoPassword" (input)="calcularFortalezaPassword()" />
        <span class="icono-visualizar" (click)="mostrarPasswordNueva = !mostrarPasswordNueva" [attr.aria-label]="mostrarPasswordNueva ? 'Ocultar' : 'Mostrar'" tabindex="0">
          @if(!mostrarPasswordNueva){
            <img src="/svgs/icono-ojo.svg" width="22" height="22" alt="Mostrar" />
          }
          @if(mostrarPasswordNueva){
            <img src="/svgs/icono-ojo-off.svg" width="22" height="22" alt="Ocultar" />
          }
        </span>
      </div>
      <ul class="password-requisitos">
        <li [class.cumplido]="passwordNueva.length >= 6">
          <span class="icono-requisito">@if(passwordNueva.length >= 6){✔️} @else{❌}</span>
          Mínimo 6 caracteres
        </li>
      </ul>
      @if(fortalezaPassword.texto){
        <div class="password-strength-bar" [ngClass]="fortalezaPassword.clase">
          <span>Fortaleza: {{ fortalezaPassword.texto }}</span>
        </div>
      }
    </div>
    <div class="form-group">
      <label for="passwordRepetir">Repetir nueva contraseña</label>
      <div class="input-con-visualizador">
        <input [type]="mostrarPasswordRepetir ? 'text' : 'password'" id="passwordRepetir" name="passwordRepetir" [(ngModel)]="passwordRepetir" required minlength="6" [disabled]="cambiandoPassword" (input)="passwordRepetirInput = true" />
        <span class="icono-visualizar" (click)="mostrarPasswordRepetir = !mostrarPasswordRepetir" [attr.aria-label]="mostrarPasswordRepetir ? 'Ocultar' : 'Mostrar'" tabindex="0">
          @if(!mostrarPasswordRepetir){
            <img src="/svgs/icono-ojo.svg" width="22" height="22" alt="Mostrar" />
          }
          @if(mostrarPasswordRepetir){
            <img src="/svgs/icono-ojo-off.svg" width="22" height="22" alt="Ocultar" />
          }
        </span>
      </div>
      <span class="coincidencia-password">
        @if(passwordRepetirInput && passwordRepetir && passwordNueva && passwordRepetir === passwordNueva){
          <span class="coincide">✔️ Coinciden</span>
        }
        @if(passwordRepetirInput && passwordRepetir && passwordNueva && passwordRepetir !== passwordNueva){
          <span class="no-coincide">❌ No coinciden</span>
        }
      </span>
    </div>
    @if(mensajePassword){
      <div class="mensaje-password">{{ mensajePassword }}</div>
    }
    <button type="submit"
      [disabled]="cambiandoPassword
        || !passwordActual
        || passwordNueva.length < 6
        || passwordNueva !== passwordRepetir">
      Cambiar contraseña
    </button>
  </form>
</div>
